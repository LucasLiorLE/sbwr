<!DOCTYPE html>
<style>
    :root {
        --bg-light: #ffffff;
        --bg-dark: #0d1117;
        --card-bg-light: #ffffff;
        --card-bg-dark: #161b22;
        --text-light: #24292f;
        --text-dark: #f0f6fc;
        --border-light: #d1d9e0;
        --border-dark: #30363d;
        --primary-color: #0969da;
        --hover-bg-light: #f6f8fa;
        --hover-bg-dark: #21262d;
    }

    * {
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
    }

    body {
        background-color: var(--bg-light);
        color: var(--text-light);
        min-height: 100vh;
        transition: background-color 0.3s ease, color 0.3s ease;
    }

    [data-bs-theme="dark"] body {
        background-color: var(--bg-dark);
        color: var(--text-dark);
    }

    .main-title {
        color: var(--primary-color);
        font-weight: 600;
        font-size: 2.5rem;
        text-align: center;
        margin-bottom: 2rem;
        transition: color 0.3s ease;
    }

    @media (max-width: 768px) {
        .main-title {
            font-size: 2rem;
        }
    }

    .card {
        border-radius: 6px;
        background: var(--card-bg-light);
        border: 1px solid var(--border-light);
        margin-bottom: 1rem;
        transition: background-color 0.3s ease, border-color 0.3s ease;
    }

    [data-bs-theme="dark"] .card {
        background: var(--card-bg-dark);
        border: 1px solid var(--border-dark);
    }

    .card-header {
        background-color: var(--hover-bg-light);
        color: var(--text-light);
        font-size: 1.1rem;
        font-weight: 500;
        border-top-left-radius: 6px;
        border-top-right-radius: 6px;
        cursor: pointer;
        user-select: none;
        padding: 1rem 1.25rem;
        display: flex;
        align-items: center;
        justify-content: space-between;
        border-bottom: 1px solid var(--border-light);
        transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
    }

    [data-bs-theme="dark"] .card-header {
        background-color: var(--hover-bg-dark);
        color: var(--text-dark);
        border-bottom: 1px solid var(--border-dark);
    }

    .card-header:hover {
        background-color: var(--primary-color);
        color: white;
    }

    .collapse-icon {
        font-size: 1rem;
        transition: transform 0.2s ease;
    }

    .card-header.collapsed .collapse-icon {
        transform: rotate(-90deg);
    }

    .table {
        margin-bottom: 0;
    }

    .table th {
        background-color: var(--hover-bg-light);
        border: none;
        font-weight: 500;
        font-size: 0.875rem;
        padding: 0.75rem 1rem;
        transition: background-color 0.3s ease;
    }

    [data-bs-theme="dark"] .table th {
        background-color: var(--hover-bg-dark);
    }

    .table td {
        vertical-align: middle;
        padding: 0.75rem 1rem;
        border-color: var(--border-light);
        transition: border-color 0.3s ease;
    }

    .table tbody tr:hover {
        background-color: var(--hover-bg-light);
    }

    [data-bs-theme="dark"] .table {
        --bs-table-bg: transparent;
        --bs-table-color: var(--text-dark);
        --bs-table-border-color: var(--border-dark);
        --bs-table-hover-bg: var(--hover-bg-dark);
    }

    .search-container {
        position: relative;
        max-width: 500px;
        margin: 0 auto 2rem;
    }

    #searchBox {
        border-radius: 6px;
        border: 1px solid var(--border-light);
        background: var(--card-bg-light);
        color: var(--text-light);
        padding: 0.75rem 1rem;
        font-size: 1rem;
        width: 100%;
        transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
    }

    [data-bs-theme="dark"] #searchBox {
        background: var(--card-bg-dark);
        color: var(--text-dark);
        border-color: var(--border-dark);
    }

    #searchBox:focus {
        border-color: var(--primary-color);
        outline: none;
        box-shadow: 0 0 0 2px rgba(9, 105, 218, 0.3);
    }

    .theme-toggle {
        position: fixed;
        top: 1rem;
        right: 7rem;
        z-index: 1000;
        border-radius: 6px;
        width: 40px;
        height: 40px;
        border: 1px solid var(--border-light);
        background: var(--card-bg-light);
        color: var(--text-light);
        font-size: 1rem;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
    }

    [data-bs-theme="dark"] .theme-toggle {
        background: var(--card-bg-dark);
        border-color: var(--border-dark);
        color: var(--text-dark);
    }

    .theme-toggle:hover {
        background-color: var(--hover-bg-light);
    }

    [data-bs-theme="dark"] .theme-toggle:hover {
        background-color: var(--hover-bg-dark);
    }

    .discord-button {
        position: fixed;
        top: 1rem;
        right: 7rem;
        z-index: 1000;
        border-radius: 6px;
        width: 40px;
        height: 40px;
        border: 1px solid var(--border-light);
        background: #5865f2;
        color: white;
        font-size: 1rem;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
        text-decoration: none;
    }

    .discord-button:hover {
        background: #4752c4;
        color: white;
        transform: scale(1.05);
    }

    [data-bs-theme="dark"] .discord-button {
        border-color: var(--border-dark);
    }

    .roblox-button {
        position: fixed;
        top: 1rem;
        right: 1rem;
        z-index: 1000;
        border-radius: 6px;
        width: 40px;
        height: 40px;
        border: 1px solid var(--border-light);
        background: #335fff;
        color: white;
        font-size: 1rem;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
        text-decoration: none;
    }

    .roblox-button:hover {
        background: #0080cc;
        color: white;
        transform: scale(1.05);
    }

    [data-bs-theme="dark"] .roblox-button {
        border-color: var(--border-dark);
    }

    .roblox-icon {
        width: 24px;
        height: 24px;
        fill: white;
    }

    .roblox-button svg {
        border-radius: 6px;
        width: 24px;
        height: 24px;
        display: block;
    }

    .roblox-link {
        color: var(--primary-color);
        text-decoration: none;
        font-weight: 500;
        transition: color 0.3s ease;
    }

    .roblox-link:hover {
        text-decoration: underline;
    }

    .loading-spinner {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        height: 300px;
        font-size: 1rem;
        transition: color 0.3s ease;
    }

    .custom-spinner {
        width: 32px;
        height: 32px;
        border: 2px solid var(--border-light);
        border-left: 2px solid var(--primary-color);
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin-bottom: 1rem;
        transition: border-color 0.3s ease;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    .empty-category {
        text-align: center;
        padding: 2rem;
        color: #656d76;
        font-style: italic;
        transition: color 0.3s ease;
    }

    .search-highlight {
        background: #fff8c5;
        border-radius: 2px;
        padding: 1px 2px;
        transition: background-color 0.3s ease;
    }

    [data-bs-theme="dark"] .search-highlight {
        background: #ffd33d40;
    }

    .btn {
        border-radius: 6px;
        font-weight: 500;
        border: 1px solid var(--border-light);
        transition: all 0.3s ease;
    }

    [data-bs-theme="dark"] .btn {
        border-color: var(--border-dark);
    }

    .container {
        max-width: 1200px;
    }

    .disclaimer {
        text-align: center;
        padding: 2rem 1rem;
        margin-top: 3rem;
        border-top: 1px solid var(--border-light);
        color: #656d76;
        font-size: 0.875rem;
        font-style: italic;
        transition: color 0.3s ease, border-color 0.3s ease;
    }

    [data-bs-theme="dark"] .disclaimer {
        border-top-color: var(--border-dark);
        color: #7d8590;
    }

    .disclaimer-link {
        color: var(--primary-color);
        text-decoration: none;
        font-weight: 500;
    }

    .disclaimer-link:hover {
        text-decoration: underline;
    }

    .general-rules, .other-info-box {
        max-width: 700px;
        margin: 2rem auto 2rem auto;
        background: var(--card-bg-light);
        border: 1px solid var(--border-light);
        border-radius: 8px;
        padding: 1.5rem 2rem;
        color: var(--text-light);
        font-size: 1rem;
        box-shadow: 0 2px 8px 0 rgba(0,0,0,0.03);
        transition: background-color 0.3s, color 0.3s, border-color 0.3s;
        position: relative;
    }
    [data-bs-theme="dark"] .general-rules,
    [data-bs-theme="dark"] .other-info-box {
        background: var(--card-bg-dark);
        color: var(--text-dark);
        border-color: var(--border-dark);
    }
    .general-rules h2, .other-info-box h2 {
        font-size: 1.25rem;
        font-weight: 600;
        margin-bottom: 1rem;
        color: var(--primary-color);
    }
    .general-rules ol {
        padding-left: 1.5rem;
        margin-bottom: 0;
    }
    .general-rules li {
        margin-bottom: 0.5rem;
    }
    .close-btn {
        position: absolute;
        top: 0.75rem;
        right: 1rem;
        background: transparent;
        border: none;
        color: var(--text-light);
        font-size: 1.25rem;
        cursor: pointer;
        transition: color 0.2s;
    }
    [data-bs-theme="dark"] .close-btn {
        color: var(--text-dark);
    }
    .show-toggle-btn {
        display: block;
        margin: 0 auto 1.5rem auto;
        font-size: 1rem;
        color: var(--primary-color);
        background: none;
        border: none;
        cursor: pointer;
        font-weight: 500;
        text-decoration: underline;
        transition: color 0.2s;
    }
    .show-toggle-btn:hover {
        color: #0056b3;
    }
    .other-info-box ul {
        padding-left: 1.5rem;
        margin-bottom: 0.5rem;
    }
    .other-info-box li {
        margin-bottom: 0.5rem;
    }
    .other-info-box a {
        color: var(--primary-color);
        text-decoration: underline;
    }
    .other-info-box a:hover {
        color: #0056b3;
    }
    .category-extras-row {
        display: flex;
        gap: 2rem;
        margin: 1.25rem 0 1.5rem 0;
        flex-wrap: wrap;
        align-items: flex-start;
    }
    .category-rules-box, .category-otherinfo-box {
        flex: 1 1 320px;
        min-width: 260px;
        background: var(--card-bg-light);
        border: 1px solid var(--border-light);
        border-radius: 8px;
        padding: 1.25rem 1.5rem 1rem 1.5rem;
        color: var(--text-light);
        font-size: 0.98rem;
        box-shadow: 0 2px 8px 0 rgba(0,0,0,0.03);
        position: relative;
        margin-bottom: 0;
        margin-top: 0;
        transition: background-color 0.3s, color 0.3s, border-color 0.3s;
    }
    [data-bs-theme="dark"] .category-rules-box,
    [data-bs-theme="dark"] .category-otherinfo-box {
        background: var(--card-bg-dark);
        color: var(--text-dark);
        border-color: var(--border-dark);
    }
    .category-rules-box h2, .category-otherinfo-box h2 {
        font-size: 1.1rem;
        font-weight: 600;
        margin-bottom: 0.75rem;
        color: var(--primary-color);
    }
    .category-rules-box ol, .category-otherinfo-box ul {
        padding-left: 1.25rem;
        margin-bottom: 0.5rem;
    }
    .category-rules-box li, .category-otherinfo-box li {
        margin-bottom: 0.4rem;
    }
    .category-rules-box .close-btn, .category-otherinfo-box .close-btn {
        top: 0.5rem;
        right: 0.75rem;
        font-size: 1.1rem;
    }
    .show-toggle-btn {
        margin-top: 0.5rem;
        margin-bottom: 1.25rem;
    }
    .category-rules-list, .category-otherinfo-list {
        padding-left: 0;
        margin-bottom: 0.5rem;
    }
    .category-rules-list > div,
    .category-otherinfo-list > div {
        margin-bottom: 0.4rem;
        padding-left: 0;
        position: relative;
    }
    @media (max-width: 900px) {
        .category-extras-row {
            flex-direction: column;
            gap: 1rem;
        }
        .category-rules-box, .category-otherinfo-box {
            min-width: 0;
            width: 100%;
        }
    }

    .sheets-button {
        position: fixed;
        top: 1rem;
        right: 4rem;
        z-index: 1000;
        border-radius: 6px;
        width: 40px;
        height: 40px;
        border: 1px solid var(--border-light);
        background: #0F9D58;
        color: #fff;
        font-size: 1rem;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
        text-decoration: none;
    }
    .sheets-button:hover {
        background: #0c7c43;
        color: #fff;
        transform: scale(1.05);
    }
    [data-bs-theme="dark"] .sheets-button {
        border-color: var(--border-dark);
    }
</style>
<html lang="en" data-bs-theme="light">
<head>
    <meta charset="UTF-8">
    <title>Slap Battles World Records</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
</head>
<body>
    <button class="btn theme-toggle" id="themeToggle" style="right: 10rem;">
        <i class="bi bi-moon-fill"></i>
    </button>
    
    <a href="https://discord.gg/knzkVdCVKv" target="_blank" class="discord-button" title="Join Discord Server" style="right: 7rem;">
        <i class="bi bi-discord"></i>
    </a>
    
    <a href="https://docs.google.com/spreadsheets/d/1B4smOTQ1ZYjhb3JMXQAYWeikb2Sm3P56UBo43ComjYw/edit?gid=0#gid=0"
       target="_blank" class="sheets-button" title="View Offical Sheet">
    <svg width="24" height="24" viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg">
        <rect x="10" y="10" width="28" height="2.5" rx="1" fill="#fff"/>
        <rect x="10" y="10" width="2.5" height="30" rx="1" fill="#fff"/>
        <rect x="10" y="24" width="28" height="2.5" rx="1" fill="#fff"/>
        <rect x="36" y="10" width="2.5" height="30" rx="1" fill="#fff"/>
        <rect x="10" y="38" width="28" height="2.5" rx="1" fill="#fff"/>
        <rect x="23" y="10" width="2.5" height="30" rx="1" fill="#fff"/>
    </svg>
    </a>

    <a href="https://www.roblox.com/games/6403373529/Slap-Battles" target="_blank" class="roblox-button" title="Play Slap Battles">
        <svg class="roblox-icon" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg">
            <polygon points="120,60 60,392 392,452 452,120" fill="#fff"/>
            <rect x="210" y="210" width="92" height="92" transform="rotate(14 256 256)" fill="#335fff"/>
        </svg>
    </a>
    <div class="container my-5">
        <h1 class="main-title">Slap Battles World Records</h1>

        <div id="rulesSection">
            <div class="general-rules" id="generalRulesBox">
                <button class="close-btn" id="closeRulesBtn" title="Hide rules" aria-label="Close">&times;</button>
                <h2><i class="bi bi-clipboard-check me-2"></i>General Rules</h2>
                <ol>
                    <li>No breaking any in-game rules</li>
                    <li>You must record your full run</li>
                    <li>Speedruns must be done with a timer</li>
                    <li>Videos must be raw footage (no splicing/cutting)</li>
                    <li>If you try to loophole rules, the run will be denied.</li>
                    <li>Run must have been done after the sheet released.</li>
                    <li>Do not use macros or multiple accounts at once</li>
                </ol>
            </div>
            <button class="show-toggle-btn" id="showRulesBtn" style="display:none;">Show General Rules</button>
        </div>

        <div id="otherInfoSection">
            <div class="other-info-box" id="otherInfoBox">
                <button class="close-btn" id="closeOtherInfoBtn" title="Hide info" aria-label="Close">&times;</button>
                <h2><i class="bi bi-info-circle me-2"></i>Other Info</h2>
                <ul>
                    <li>
                        Timer Tutorial (Livesplit): 
                        <a href="https://www.youtube.com/watch?v=xq2MCodtH34" target="_blank" rel="noopener">https://www.youtube.com/watch?v=xq2MCodtH34</a>
                    </li>
                    <li>
                        Recorder Tutorial (OBS): 
                        <a href="https://www.youtube.com/watch?v=1cnpVLaD6Y0" target="_blank" rel="noopener">https://www.youtube.com/watch?v=1cnpVLaD6Y0</a>
                    </li>
                    <li>
                        (You can use an alternative timer/recorder to OBS or Livesplit)
                    </li>
                </ul>
                <ul>
                    <li>
                        An <b>active server</b> means there has to be some people fighting for the majority of the run (so you can't go into a completely dead server and easily get a WR). This also means that people have to actually be able to fight you.
                    </li>
                    <li>
                        You can use multiple accounts to set up a run, but <b>not for the run itself</b>.
                    </li>
                </ul>
            </div>
            <button class="show-toggle-btn" id="showOtherInfoBtn" style="display:none;">Show Other Info</button>
        </div>

        <div class="search-container">
            <input type="text" id="searchBox" class="form-control" placeholder="Search categories or usernames...">
        </div>
        
        <div id="loadingIndicator" class="loading-spinner">
            <div class="custom-spinner"></div>
            <div>Loading world records...</div>
        </div>
        
        <div id="recordsContainer" style="display: none;">
        </div>
        
        <div class="disclaimer">
            Not affiliated with Slap Battles (unofficial site) made by <a href="https://www.roblox.com/users/1919501120/profile" target="_blank" class="disclaimer-link">LucasLiorLE</a>
        </div>
    </div>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        let recordsData = {};
        let collapsedCategories = new Set();
        const container = document.getElementById('recordsContainer');
        const searchBox = document.getElementById('searchBox');
        const loadingIndicator = document.getElementById('loadingIndicator');
        const themeToggle = document.getElementById('themeToggle');
        const html = document.documentElement;

        const savedTheme = localStorage.getItem('theme') || 'light';
        const savedCollapsed = JSON.parse(localStorage.getItem('collapsedCategories') || '[]');
        collapsedCategories = new Set(savedCollapsed);
        
        html.setAttribute('data-bs-theme', savedTheme);
        updateThemeIcon(savedTheme);

        themeToggle.addEventListener('click', () => {
            const currentTheme = html.getAttribute('data-bs-theme');
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            html.setAttribute('data-bs-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            updateThemeIcon(newTheme);
        });

        function updateThemeIcon(theme) {
            const icon = themeToggle.querySelector('i');
            icon.className = theme === 'light' ? 'bi bi-moon-fill' : 'bi bi-sun-fill';
        }

        function saveCollapsedState() {
            localStorage.setItem('collapsedCategories', JSON.stringify([...collapsedCategories]));
        }

        function getEvidenceButtonText(evidence) {
            if (evidence.includes('youtu')) return 'YouTube';
            if (evidence.includes('medal')) return 'Medal';
            if (evidence.includes('streamable')) return 'Streamable';
            if (evidence.includes('twitch')) return 'Twitch';
            return 'View';
        }

        function getEvidenceButtonClass(evidence) {
            if (evidence.includes('youtu')) return 'btn-danger';
            if (evidence.includes('medal')) return 'btn-warning';
            if (evidence.includes('streamable')) return 'btn-info';
            if (evidence.includes('twitch')) return 'btn-primary';
            return 'btn-secondary';
        }

        function highlightSearchTerm(text, searchTerm) {
            if (!searchTerm) return text;
            const regex = new RegExp(`(${searchTerm})`, 'gi');
            return text.replace(regex, '<span class="search-highlight">$1</span>');
        }

        async function renderRecords(filter="") {
            container.innerHTML = "";
            const filterLower = filter.toLowerCase();
            let animationDelay = 0;
            
            for (const [category, categoryData] of Object.entries(recordsData)) {
                const records = categoryData.records || [];
                const headers = categoryData.headers || {username: "Username", "time": "Time", evidence: "Evidence"};
                const rules = categoryData.rules || [];
                const otherInfo = categoryData.other_info || [];
                
                const categoryMatches = !filter || category.toLowerCase().includes(filterLower);
                const matchingRecords = filter ? records.filter(rec => 
                    rec.username && rec.username.toLowerCase().includes(filterLower)
                ) : records;
                
                if (!categoryMatches && matchingRecords.length === 0) continue;

                const isCollapsed = collapsedCategories.has(category);
                const card = document.createElement('div');
                card.className = "card mb-4 fade-in stagger-animation";
                card.style.setProperty('--stagger', animationDelay++);
                
                let tableContent = '';
                const recordsToShow = categoryMatches ? records : matchingRecords;
                
                let extrasHtml = '';
                if ((rules && rules.length) || (otherInfo && otherInfo.length)) {
                    extrasHtml = window.renderCategoryExtras(
                        category.replace(/[^a-zA-Z0-9_-]/g, "_"),
                        rules,
                        otherInfo
                    );
                }
                
                if (recordsToShow.length === 0) {
                    tableContent = `<div class="empty-category">
                        <i class="bi bi-inbox" style="font-size: 2rem; margin-bottom: 1rem; display: block;"></i>
                        No records yet for this category
                    </div>`;
                } else {
                    let tableRows = '';
                    for (const rec of recordsToShow) {
                        const highlightedUsername = highlightSearchTerm(rec.username, filter);
                        const usernameCell = highlightedUsername;
                        
                        let evidenceCell;
                        if (rec.evidence && (rec.evidence.startsWith('http://') || rec.evidence.startsWith('https://'))) {
                            const buttonText = getEvidenceButtonText(rec.evidence);
                            const buttonClass = getEvidenceButtonClass(rec.evidence);
                            evidenceCell = `<a href="${rec.evidence}" target="_blank" class="btn btn-sm ${buttonClass}">
                                <i class="bi bi-play-circle me-1"></i>${buttonText}
                            </a>`;
                        } else if (rec.evidence && (rec.evidence.toLowerCase().includes('youtube') || rec.evidence.toLowerCase().includes('medal'))) {
                            evidenceCell = `<span class="badge bg-secondary">${rec.evidence}</span>`;
                        } else {
                            evidenceCell = rec.evidence || `<span class="text-muted">
                                <i class="bi bi-exclamation-circle me-1"></i>No evidence
                            </span>`;
                        }
                        
                        tableRows += `
                            <tr>
                                <td>${usernameCell}</td>
                                <td><strong>${rec.time}</strong></td>
                                <td>${evidenceCell}</td>
                            </tr>
                        `;
                    }
                    
                    tableContent = `
                        <div class="table-responsive">
                            <table class="table table-hover mb-0">
                                <thead>
                                    <tr>
                                        <th><i class="bi bi-person me-2"></i>${headers.username}</th>
                                        <th><i class="bi bi-clock me-2"></i>${headers.time}</th>
                                        <th><i class="bi bi-camera-video me-2"></i>${headers.evidence}</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${tableRows}
                                </tbody>
                            </table>
                        </div>
                    `;
                }
                
                const highlightedCategory = highlightSearchTerm(category, categoryMatches ? filter : '');
                card.innerHTML = `
                    <div class="card-header ${isCollapsed ? 'collapsed' : ''}" onclick="toggleCategory('${category}')">
                        <span>${highlightedCategory}</span>
                        <i class="bi bi-chevron-down collapse-icon"></i>
                    </div>
                    <div class="card-body p-0 collapse ${isCollapsed ? '' : 'show'}" id="collapse-${category.replace(/\s+/g, '-')}">
                        ${extrasHtml}
                        ${tableContent}
                    </div>
                `;
                container.appendChild(card);
            }
        }

        window.toggleCategory = function(category) {
            const element = document.getElementById(`collapse-${category.replace(/\s+/g, '-')}`);
            const header = element.previousElementSibling;
            
            if (collapsedCategories.has(category)) {
                collapsedCategories.delete(category);
                element.classList.add('show');
                header.classList.remove('collapsed');
            } else {
                collapsedCategories.add(category);
                element.classList.remove('show');
                header.classList.add('collapsed');
            }
            saveCollapsedState();
        };

        fetch("https://api.allorigins.win/get?url=" + encodeURIComponent("http://eu-ro-01.wisp.uno:9761/api/sbwr/get-records"))
            .then(res => res.json())
            .then(data => {
                let actualData = {};
                try {
                    actualData = JSON.parse(data.contents);
                } catch (e) {
                    console.error('Failed to parse records data:', e);
                    throw new Error('Invalid data format received');
                }
                recordsData = actualData;
                loadingIndicator.style.display = 'none';
                container.style.display = 'block';
                renderRecords();
            })
            .catch(error => {
                console.error('Error loading records:', error);
                loadingIndicator.innerHTML = `
                    <div class="text-danger">
                        <i class="bi bi-exclamation-triangle" style="font-size: 2rem; margin-bottom: 1rem; display: block;"></i>
                        Failed to load records. Please try again later.
                    </div>
                `;
            });

        searchBox.addEventListener("input", function() {
            renderRecords(this.value);
        });

        const generalRulesBox = document.getElementById('generalRulesBox');
        const closeRulesBtn = document.getElementById('closeRulesBtn');
        const showRulesBtn = document.getElementById('showRulesBtn');
        const otherInfoBox = document.getElementById('otherInfoBox');
        const closeOtherInfoBtn = document.getElementById('closeOtherInfoBtn');
        const showOtherInfoBtn = document.getElementById('showOtherInfoBtn');

        closeRulesBtn.addEventListener('click', function() {
            generalRulesBox.style.display = 'none';
            showRulesBtn.style.display = 'block';
        });
        showRulesBtn.addEventListener('click', function() {
            generalRulesBox.style.display = 'block';
            showRulesBtn.style.display = 'none';
        });

        closeOtherInfoBtn.addEventListener('click', function() {
            otherInfoBox.style.display = 'none';
            showOtherInfoBtn.style.display = 'block';
        });
        showOtherInfoBtn.addEventListener('click', function() {
            otherInfoBox.style.display = 'block';
            showOtherInfoBtn.style.display = 'none';
        });
    });


    window.renderCategoryExtras = function(category, rules, otherInfo) {
        let rulesHtml = '', infoHtml = '', showRulesBtn = '', showInfoBtn = '';
        if (rules && rules.length) {
            rulesHtml = `
                <div class="category-rules-box" id="rules-box-${category}">
                    <button class="close-btn" onclick="document.getElementById('rules-box-${category}').style.display='none';document.getElementById('show-rules-btn-${category}').style.display='block';" title="Hide rules" aria-label="Close">&times;</button>
                    <h2><i class="bi bi-clipboard-check me-2"></i>Category Rules</h2>
                    <div class="category-rules-list">
                        ${rules.map(r=>`<div>${r}</div>`).join('')}
                    </div>
                </div>
            `;
            showRulesBtn = `<button class="show-toggle-btn" id="show-rules-btn-${category}" style="display:none;" onclick="document.getElementById('rules-box-${category}').style.display='block';this.style.display='none';">Show Category Rules</button>`;
        }
        if (otherInfo && otherInfo.length) {
            infoHtml = `
                <div class="category-otherinfo-box" id="otherinfo-box-${category}">
                    <button class="close-btn" onclick="document.getElementById('otherinfo-box-${category}').style.display='none';document.getElementById('show-otherinfo-btn-${category}').style.display='block';" title="Hide info" aria-label="Close">&times;</button>
                    <h2><i class="bi bi-info-circle me-2"></i>Other Info</h2>
                    <div class="category-otherinfo-list">
                        ${otherInfo.map(r=>`<div>${r}</div>`).join('')}
                    </div>
                </div>
            `;
            showInfoBtn = `<button class="show-toggle-btn" id="show-otherinfo-btn-${category}" style="display:none;" onclick="document.getElementById('otherinfo-box-${category}').style.display='block';this.style.display='none';">Show Other Info</button>`;
        }
        if (rulesHtml || infoHtml) {
            return `
                <div class="category-extras-row">
                    ${rulesHtml}
                    ${infoHtml}
                </div>
                <div style="display:flex;gap:1rem;">
                    ${showRulesBtn}
                    ${showInfoBtn}
                </div>
            `;
        }
        return '';
    }
</script>
</body>
</html>
